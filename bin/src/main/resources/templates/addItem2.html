<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/new_app :: ~{html} (content = ~{::content})}">

<body>
<div th:fragment="content">
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="card">
                <div class="card-header"><h3 class="fw-bold mb-0">เพิ่มสต็อกจำนวนมาก (สร้างรหัสอัตโนมัติ)</h3></div>
                <div class="card-body p-4">

                    <form th:action="@{/admin/items/add}" th:object="${newItem}" method="POST">

                        <div th:if="${#fields.hasErrors('*')}" class="alert alert-danger">
                            <ul class="mb-0">
                                <li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
                            </ul>
                        </div>

						<div class="mb-3">
						    <label for="equipmentId" class="form-label fw-bold">อุปกรณ์</label>
						    <select th:field="*{equipmentId}" class="form-select" required>
						        <option value="" selected disabled>-- กรุณาเลือก --</option>
						        <option th:each="eq : ${equip}"
						                th:value="${eq.id}"
						                th:attr="data-prefix=${eq.prefix}"
						                th:text="${eq.equipName}"></option>
						    </select>
						</div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="prefix_display" class="form-label fw-bold">รหัสนำหน้า (Prefix)</label>
                                <input type="text" id="prefix_display" class="form-control" value="--" disabled>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="quantity" class="form-label fw-bold">จำนวนที่ต้องการเพิ่ม</label>
                                <input type="number" th:field="*{quantity}" class="form-control" min="1" required>
                            </div>
                        </div>
                        <hr>
                        <button type="submit" class="btn btn-primary fw-bold">สร้างไอเทมทั้งหมด</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function () {
            const equipSelected = document.getElementById('equipmentId');
            const prefixDisplay = document.getElementById('prefix_display');

            function updatePrefix() {
                if (equipSelected.selectedIndex > 0) {
                    const selectedOption = equipSelected.options[equipSelected.selectedIndex];
                    const prefix = selectedOption.getAttribute('data-prefix');
                    prefixDisplay.value = prefix ? prefix : '--';
                } else {
                    prefixDisplay.value = '--';
                }
            }

            equipSelected.addEventListener('change', updatePrefix);
            updatePrefix();
        });
    </script>
</div>
</body>
</html>